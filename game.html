<html>
<head>
</head>
<body>
  <canvas height="600" width="800" id="game">  </canvas>
  <script>
    var canvas;
    var canvasContext;
    var ballX = 400;
    var ballY = 300;
    var ballSpeedX = 5;
    var ballSpeedY = 5;
    var frames = 40;
    var paddle1Y = 250;
    var paddle2Y = 250;
    const PADDLE_HEIGHT = 100;
    var player1Score = 0;
    var compScore = 0;

    window.onload = function () {
      canvas = document.getElementById('game');
      canvasContext = canvas.getContext('2d');
      setInterval(callEverything,1000/frames);
      canvas.addEventListener('mousemove',function(evt){
        var mousePos = calMousePos(evt);
        paddle1Y = mousePos.y - (PADDLE_HEIGHT/2);
      });
    }

    function callEverything(){
      draw();
      move();
    }

    function calMousePos(evt){
      var rect = canvas.getBoundingClientRect();
      var root = document.documentElement;
      var mouseX = evt.clientX - rect.left - root.scrollLeft;
      var mouseY = evt.clientY - rect.top - root.scrollTop;
      return {
        x:mouseX,
        y:mouseY
      };
    }

    function draw(){
      canvasContext.fillStyle = 'black';
      canvasContext.fillRect(0,0,canvas.width,canvas.height);
      canvasContext.fillStyle = 'white';
      canvasContext.fillRect(5,paddle1Y,10,PADDLE_HEIGHT);  // left paddle
      canvasContext.fillRect(785,paddle2Y,10,PADDLE_HEIGHT);   // right paddle
      // ball
      canvasContext.beginPath();
      canvasContext.arc(ballX,ballY,10,0,Math.PI * 2,true);
      canvasContext.fill();
      canvasContext.fillText(player1Score,100,100);
      canvasContext.fillText(compScore,canvas.width-100,100);
    }

    function move(){
      paddle2move();

      ballX = ballX + ballSpeedX;
      ballY = ballY + ballSpeedY;

      //if (ballX >= canvas.width || ballX <= 0)
      //ballSpeedX = -ballSpeedX;
      if (ballX <= 15 )
      {
        //ballSpeedX = -ballSpeedX;
        //console.log(ballY);
        if (ballY > paddle1Y && ballY < paddle1Y + PADDLE_HEIGHT)
        {
          ballSpeedX = -ballSpeedX;
          //console.log(paddle1Y);
        }
        else
        {
          //console.log(ballY);
          ballReset();
          compScore++;
        }
      }
      if (ballX >= 785)
      {
        if (ballY > paddle2Y && ballY < paddle2Y + PADDLE_HEIGHT)
        ballSpeedX = -ballSpeedX;
        else {
          ballReset();
          player1Score++;
        }
      }
      if (ballY <= 0 || ballY >= 600)
      ballSpeedY = -ballSpeedY;
    }

    function paddle2move(){
      var paddle2YCenter = paddle2Y + PADDLE_HEIGHT/2;
      if (ballY < paddle2YCenter && ballX > canvas.width/2 && ballSpeedX > 0)
      paddle2Y -= 5;
      else if (ballY > paddle2YCenter && ballX > canvas.width/2 && ballSpeedX > 0) {
        paddle2Y += 5;
      }
    }

    function ballReset(){
      ballSpeedX = -ballSpeedX;
      ballX = canvas.width/2;
      ballY = canvas.height/2;
    }
  </script>
</body>
</html>
